{"version":3,"sources":["file:///C:/GameECSProject/assets/scripts/systems/RenderSystem.ts"],"names":["RenderSystem","instantiate","Vec3","PlayerTag","PrefabNames","EnemyTag","TileTag","Position","ViewComponent","constructor","entityManager","prefabs","gameRoot","console","log","tile","isValid","activeInHierarchy","getWorldPosition","getPrefabName","entityId","hasComponent","Player","Enemy","Tile","render","entities","getEntityWithComponent","id","prefabName","position","getComponent","view","addComponent","prefab","node","setPosition","x","y","addChild"],"mappings":";;;sKAUaA,Y;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAVJC,MAAAA,W,OAAAA,W;AAAqBC,MAAAA,I,OAAAA,I;;AAGrBC,MAAAA,S,iBAAAA,S;;AACAC,MAAAA,W,iBAAAA,W;;AACAC,MAAAA,Q,iBAAAA,Q;;AACAC,MAAAA,O,iBAAAA,O;;AACAC,MAAAA,Q,iBAAAA,Q;;AACAC,MAAAA,a,iBAAAA,a;;;;;;;;;8BAEIR,Y,GAAN,MAAMA,YAAN,CAAmB;AACtBS,QAAAA,WAAW,CAASC,aAAT,EACSC,OADT,EAESC,QAFT,EAGV;AAAA,eAHmBF,aAGnB,GAHmBA,aAGnB;AAAA,eAFmBC,OAEnB,GAFmBA,OAEnB;AAAA,eADmBC,QACnB,GADmBA,QACnB;AACGC,UAAAA,OAAO,CAACC,GAAR,CAAYC,IAAI,CAACC,OAAjB,EAA0BD,IAAI,CAACE,iBAA/B,EAAkDF,IAAI,CAACG,gBAAL,EAAlD;AACH;;AAEDC,QAAAA,aAAa,CAACC,QAAD,EAAqC;AAC9C,cAAI,KAAKV,aAAL,CAAmBW,YAAnB,CAAgCD,QAAhC;AAAA;AAAA,qCAAJ,EAA0D,OAAO;AAAA;AAAA,0CAAYE,MAAnB;AAC1D,cAAI,KAAKZ,aAAL,CAAmBW,YAAnB,CAAgCD,QAAhC;AAAA;AAAA,mCAAJ,EAAyD,OAAO;AAAA;AAAA,0CAAYG,KAAnB;AACzD,cAAI,KAAKb,aAAL,CAAmBW,YAAnB,CAAgCD,QAAhC;AAAA;AAAA,iCAAJ,EAAwD,OAAO;AAAA;AAAA,0CAAYI,IAAnB;AACxD,iBAAO,IAAP;AACH;;AAEDC,QAAAA,MAAM,GAAE;AACJ,cAAMC,QAAQ,GAAG,KAAKhB,aAAL,CAAmBiB,sBAAnB;AAAA;AAAA,mCAAjB;;AAEA,eAAK,IAAMC,EAAX,IAAiBF,QAAjB,EAA2B;AACvB,gBAAMG,UAAU,GAAG,KAAKV,aAAL,CAAmBS,EAAnB,CAAnB;AACA,gBAAI,CAACC,UAAL,EAAiB;AACjB,gBAAMC,QAAQ,GAAG,KAAKpB,aAAL,CAAmBqB,YAAnB,CAAgCH,EAAhC;AAAA;AAAA,qCAAjB;AACA,gBAAI,CAACE,QAAL,EAAe;AAEf,gBAAIE,IAAI,GAAG,KAAKtB,aAAL,CAAmBqB,YAAnB,CAAgCH,EAAhC;AAAA;AAAA,+CAAX;;AACA,gBAAG,CAACI,IAAJ,EAAS;AACLA,cAAAA,IAAI,GAAG;AAAA;AAAA,kDAAkBH,UAAlB,CAAP;AACA,mBAAKnB,aAAL,CAAmBuB,YAAnB,CAAgCL,EAAhC,EAAoCI,IAApC;AAAA;AAAA;AAEA,kBAAME,MAAM,GAAG,KAAKvB,OAAL,CAAakB,UAAb,CAAf;AACA,kBAAMM,IAAI,GAAGlC,WAAW,CAACiC,MAAD,CAAxB;AACAC,cAAAA,IAAI,CAACC,WAAL,CAAiB,IAAIlC,IAAJ,CAAS4B,QAAQ,CAACO,CAAT,GAAa,EAAtB,EAA0BP,QAAQ,CAACQ,CAAT,GAAa,EAAvC,EAA2C,CAA3C,CAAjB;AACA,mBAAK1B,QAAL,CAAc2B,QAAd,CAAuBJ,IAAvB;AAEAH,cAAAA,IAAI,CAACG,IAAL,GAAYA,IAAZ;AACAtB,cAAAA,OAAO,CAACC,GAAR,CAAY,SAASe,UAAT,GAAsBC,QAAQ,CAACO,CAA/B,GAAmCP,QAAQ,CAACQ,CAAxD,EAVK,CAWL;AACH;AACJ;AACJ;;AAvCqB,O","sourcesContent":["import { instantiate, Prefab, Vec3, Node } from \"cc\";\nimport { PrefabKey } from \"../data/types\";\nimport { EntityManager } from \"../core/EntityManager\";\nimport { PlayerTag } from \"../components/PlayerTag\";\nimport { PrefabNames } from \"../data/consts\";\nimport { EnemyTag } from \"../components/EnemyTag\";\nimport { TileTag } from \"../components/TileTag\";\nimport { Position } from \"../components/Position\";\nimport { ViewComponent } from \"../components/ViewComponent\";\n\nexport class RenderSystem {\n    constructor(private entityManager: EntityManager,\n                private prefabs: Record<PrefabKey, Prefab>,\n                private gameRoot: Node\n    ){\n        console.log(tile.isValid, tile.activeInHierarchy, tile.getWorldPosition());\n    }\n\n    getPrefabName(entityId: number): PrefabKey | null {\n        if (this.entityManager.hasComponent(entityId, PlayerTag)) return PrefabNames.Player;\n        if (this.entityManager.hasComponent(entityId, EnemyTag)) return PrefabNames.Enemy;\n        if (this.entityManager.hasComponent(entityId, TileTag)) return PrefabNames.Tile;\n        return null;\n    }\n\n    render(){\n        const entities = this.entityManager.getEntityWithComponent(Position);\n\n        for (const id of entities) {\n            const prefabName = this.getPrefabName(id);\n            if (!prefabName) continue;\n            const position = this.entityManager.getComponent(id, Position);\n            if (!position) continue;\n\n            let view = this.entityManager.getComponent(id, ViewComponent);\n            if(!view){\n                view = new ViewComponent(prefabName);\n                this.entityManager.addComponent(id, view, ViewComponent);\n                \n                const prefab = this.prefabs[prefabName];\n                const node = instantiate(prefab);\n                node.setPosition(new Vec3(position.x * 32, position.y * 32, 0));\n                this.gameRoot.addChild(node);\n\n                view.node = node;       \n                console.log('add ' + prefabName + position.x + position.y)\n                //console.log(\"Added node\", node.name, \"at\", node.getPosition());\n            }\n        }\n    }\n}\n\n"]}