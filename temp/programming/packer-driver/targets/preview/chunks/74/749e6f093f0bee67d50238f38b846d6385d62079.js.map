{"version":3,"sources":["file:///C:/GameECSProject/assets/scripts/core/GameManager.ts"],"names":["GameManager","EntityManager","RenderSystem","RoomSystem","InputSystem","PlayerTag","Health","Damage","InputComponent","Position","InputNames","constructor","entityManager","prefabs","roomTemplate","gameRoot","playerId","createPlayer","id","createEntity","addComponent","initializeRoomTemplate","templates","initializeSystems","renderSystem","roomSystem","inputSystem","setPrefabs","getPrefab","name","setGameRoot","getPlayerEntityId","onTileTapped","pos","inputEntity","input","Move","updateSystems","dt","update"],"mappings":"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","sourcesContent":["import { Prefab, Node } from \"cc\";\nimport { InputType, PrefabType, RoomTemplate } from \"../data/types\";\nimport { EntityManager } from \"./EntityManager\";\nimport { RenderSystem } from \"../systems/RenderSystem\";\nimport { RoomSystem } from \"../systems/RoomSystem\";\nimport { InputSystem } from \"../systems/InputSystem\";\nimport { PlayerTag } from \"../components/Tag/PlayerTag\";\nimport { Health } from \"../components/Health\";\nimport { Damage } from \"../components/Damage\";\nimport { InputComponent } from \"../components/core/InputComponent\";\nimport { Position } from \"../components/Position\";\nimport { InputNames} from \"../data/consts\";\n\nexport class GameManager {\n    private entityManager: EntityManager;\n    private prefabs: Record<PrefabType, Prefab> = {} as Record<PrefabType, Prefab>;\n    private roomTemplate: RoomTemplate[] = [];\n    private gameRoot: Node = null!;\n\n    public renderSystem!: RenderSystem;\n    public roomSystem!: RoomSystem;\n    public inputSystem!: InputSystem;\n\n    private playerId: number | null = null;\n\n    constructor(){\n        this.entityManager = new EntityManager();\n    }\n\n    createPlayer() {\n        const id = this.entityManager.createEntity();\n        this.entityManager.addComponent(id, new PlayerTag(), PlayerTag);\n        this.entityManager.addComponent(id, new Position(0, 0), Position);\n        this.entityManager.addComponent(id, new Health(100), Health);\n        this.entityManager.addComponent(id, new Damage(10), Damage);\n        this.playerId = id;\n    }\n\n    /*  Паттерн синглтона через геттер (я использовал экспорт в Game)\n    private static _instance: GameManager;\n    static get instance(): GameManager {\n      if (!this._instance) {\n        this._instance = new GameManager();\n      }\n      return this._instance;\n    }\n    private constructor() {}*/\n\n    initializeRoomTemplate(templates: RoomTemplate[]) {\n        this.roomTemplate = templates;\n    }\n\n    initializeSystems(){\n        this.renderSystem = new RenderSystem(this.entityManager, this.prefabs, this.gameRoot);\n        this.roomSystem = new RoomSystem(this.entityManager, this.roomTemplate, this.playerId);\n        this.inputSystem = new InputSystem(this.entityManager, this.playerId);\n    }\n\n    setPrefabs(prefabs: Record<PrefabType, Prefab>){\n        this.prefabs = prefabs;\n    }\n\n    getPrefab(name: PrefabType): Prefab | null {\n        return this.prefabs[name] || null;\n    }\n\n    setGameRoot(gameRoot: Node){\n        this.gameRoot = gameRoot;\n    }\n\n    getPlayerEntityId(): number{\n       return this.playerId;\n    }\n\n    /*handleInput(input: InputComponent) {\n        const inputId = this.entityManager.createEntity();\n        this.entityManager.addComponent(inputId, input, InputComponent);\n        //this.inputSystem.handleInput(input);\n    }*/\n\n    /*onTileTapped(pos: Position) {\n        const entities = this.findEntitiesAtPosition(pos);\n        let input: InputType = InputNames.Move;\n        \n        for (const id of entities) {\n            if (this.entityManager.hasComponent(id, EnemyTag)) {\n                input = InputNames.Attack;\n                break;\n            }\n            if (this.entityManager.hasComponent(id, TrapComponent)) {\n                inputType = InputType.Interact;\n            }\n        }\n\n        const inputId = this.entityManager.createEntity();\n        const inputCom = new InputComponent(this.playerId, input, pos);\n        this.entityManager.addComponent(inputId, inputCom, InputComponent);\n    }\n\n    findEntitiesAtPosition(pos: Position): number[] {\n        const result: number[] = [];\n        const all = this.entityManager.getEntityWithComponent(Position);\n        for (const id of all) {\n            const p = this.entityManager.getComponent(id, Position);\n            if (p && p.x === pos.x && p.y === pos.y) {\n                result.push(id);\n            }\n        }\n        return result;\n    }*/\n\n    onTileTapped(pos: Position) {\n        const inputEntity = this.entityManager.createEntity();\n        const input = new InputComponent(this.playerId, InputNames.Move, pos);\n        this.entityManager.addComponent(inputEntity, input, InputComponent);\n    }\n\n    updateSystems(dt: number) {\n        this.inputSystem.update(dt);\n        // this.movementSystem.update(dt);\n        // this.combatSystem.update(dt);\n    }\n}\n\n"]}