{"version":3,"sources":["file:///C:/GameECSProject/assets/scripts/systems/CombatSystem.ts"],"names":["CombatSystem","eventBus","Health","constructor","em","on","onAttackStart","bind","attacker","target","console","log","hp","getComponent","health","destroyEntity","id","removeEntity"],"mappings":";;;gDAIaA,Y;;;;;;;;;;;;;;;;;;;;;;AAJJC,MAAAA,Q,iBAAAA,Q;;AAEAC,MAAAA,M,iBAAAA,M;;;;;;;8BAEIF,Y,GAAN,MAAMA,YAAN,CAAmB;AACxBG,QAAAA,WAAW,CAASC,EAAT,EAA4B;AAAA,eAAnBA,EAAmB,GAAnBA,EAAmB;AACrC;AAAA;AAAA,oCAASC,EAAT,CAAY,aAAZ,EAA2B,KAAKC,aAAL,CAAmBC,IAAnB,CAAwB,IAAxB,CAA3B;AACD;;AAEOD,QAAAA,aAAa,OAA6D;AAAA,cAA5D;AAAEE,YAAAA,QAAF;AAAYC,YAAAA;AAAZ,WAA4D;AAChFC,UAAAA,OAAO,CAACC,GAAR,qBAA8BH,QAA9B,oDAAkDC,MAAlD,EADgF,CAGhF;;AACA,cAAMG,EAAE,GAAG,KAAKR,EAAL,CAAQS,YAAR,CAAqBJ,MAArB;AAAA;AAAA,+BAAX;;AACA,cAAIG,EAAJ,EAAQ;AACNA,YAAAA,EAAE,CAACE,MAAH,IAAa,CAAb,CADM,CACY;;AAClBJ,YAAAA,OAAO,CAACC,GAAR,4BAAgCF,MAAhC,6DAAsDG,EAAE,CAACE,MAAzD;;AACA,gBAAIF,EAAE,CAACE,MAAH,IAAa,CAAjB,EAAoB;AAClB,mBAAKC,aAAL,CAAmBN,MAAnB;AACD;AACF,WAX+E,CAahF;AACA;;AACD;;AAEOM,QAAAA,aAAa,CAACC,EAAD,EAAa;AAChC;AACA,eAAKZ,EAAL,CAAQa,YAAR,CAAqBD,EAArB;AACAN,UAAAA,OAAO,CAACC,GAAR,sEAAuCK,EAAvC;AACD;;AA1BuB,O","sourcesContent":["import { eventBus }   from '../core/EventBus';\nimport { EntityManager } from '../core/EntityManager';\nimport { Health }     from '../components/Health';\n\nexport class CombatSystem {\n  constructor(private em: EntityManager) {\n    eventBus.on('attackStart', this.onAttackStart.bind(this));\n  }\n\n  private onAttackStart({ attacker, target }: { attacker: number; target: number }) {\n    console.log(`[CombatSystem] ${attacker} атакует ${target}`);\n\n    // тут можно сразу уменьшить здоровье:\n    const hp = this.em.getComponent(target, Health);\n    if (hp) {\n      hp.health -= 1;   // условно урон = 1\n      console.log(`[CombatSystem] у ${target} осталось HP=${hp.health}`);\n      if (hp.health <= 0) {\n        this.destroyEntity(target);\n      }\n    }\n\n    // и кидаем сигнал о завершении боя, когда понадобится:\n    // eventBus.emit('attackComplete', { attacker, target });\n  }\n\n  private destroyEntity(id: number) {\n    // удаляем ноду и все компоненты\n    this.em.removeEntity(id);\n    console.log(`[CombatSystem] сущность ${id} уничтожена`);\n  }\n}\n"]}