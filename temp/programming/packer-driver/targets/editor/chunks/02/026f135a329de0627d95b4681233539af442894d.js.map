{"version":3,"sources":["file:///C:/GameECSProject/assets/scripts/systems/InputSystem.ts"],"names":["InputSystem","InputComponent","EnemyTag","Position","constructor","entityManager","playerId","update","dt","inputs","getEntityWithComponent","entityId","input","getComponent","pos","target","enemyIds","enemyAtTarget","find","id","p","x","y","playerPos","moveTarget","getAdjacentTo","addComponent","MoveIntent","AttackIntent","removeComponent"],"mappings":";;;kEAKaA,W;;;;;;;;;;;;;;;;;;;;;;;;;;AAJJC,MAAAA,c,iBAAAA,c;;AACAC,MAAAA,Q,iBAAAA,Q;;AACAC,MAAAA,Q,iBAAAA,Q;;;;;;;6BAEIH,W,GAAN,MAAMA,WAAN,CAAkB;AACrBI,QAAAA,WAAW,CACCC,aADD,EAECC,QAFD,EAGT;AAAA,eAFUD,aAEV,GAFUA,aAEV;AAAA,eADUC,QACV,GADUA,QACV;AAAE;AAEJ;AACJ;AACA;AACA;;;AAEIC,QAAAA,MAAM,CAACC,EAAD,EAAa;AACf,gBAAMC,MAAM,GAAG,KAAKJ,aAAL,CAAmBK,sBAAnB;AAAA;AAAA,+CAAf;;AAEA,eAAK,MAAMC,QAAX,IAAuBF,MAAvB,EAA+B;AAC3B,kBAAMG,KAAK,GAAG,KAAKP,aAAL,CAAmBQ,YAAnB,CAAgCF,QAAhC;AAAA;AAAA,iDAAd;AACA,kBAAMG,GAAG,GAAGF,KAAK,CAACG,MAAlB,CAF2B,CAI3B;;AACA,kBAAMC,QAAQ,GAAG,KAAKX,aAAL,CAAmBK,sBAAnB;AAAA;AAAA,qCAAjB;AACA,kBAAMO,aAAa,GAAGD,QAAQ,CAACE,IAAT,CAAcC,EAAE,IAAI;AACtC,oBAAMC,CAAC,GAAG,KAAKf,aAAL,CAAmBQ,YAAnB,CAAgCM,EAAhC;AAAA;AAAA,uCAAV;AACA,qBAAO,CAAAC,CAAC,QAAD,YAAAA,CAAC,CAAEC,CAAH,MAASP,GAAG,CAACO,CAAb,IAAkB,CAAAD,CAAC,QAAD,YAAAA,CAAC,CAAEE,CAAH,MAASR,GAAG,CAACQ,CAAtC;AACH,aAHqB,CAAtB;;AAKA,gBAAIL,aAAJ,EAAmB;AACf;AACA,oBAAMM,SAAS,GAAG,KAAKlB,aAAL,CAAmBQ,YAAnB,CAAgCF,QAAhC;AAAA;AAAA,uCAAlB;AACA,oBAAMa,UAAU,GAAG,KAAKC,aAAL,CAAmBR,aAAnB,EAAkCM,SAAlC,CAAnB;;AAEA,kBAAIC,UAAJ,EAAgB;AACZ,qBAAKnB,aAAL,CAAmBqB,YAAnB,CAAgCf,QAAhC,EAA0C,IAAIgB,UAAJ,CAAeH,UAAf,CAA1C,EAAsEG,UAAtE;AACA,qBAAKtB,aAAL,CAAmBqB,YAAnB,CAAgCf,QAAhC,EAA0C,IAAIiB,YAAJ,CAAiBX,aAAjB,CAA1C,EAA2EW,YAA3E;AACH;AACJ,aATD,MASO;AACH;AACA,mBAAKvB,aAAL,CAAmBqB,YAAnB,CAAgCf,QAAhC,EAA0C,IAAIgB,UAAJ,CAAeb,GAAf,CAA1C,EAA+Da,UAA/D;AACH,aAvB0B,CAyB3B;;;AACA,iBAAKtB,aAAL,CAAmBwB,eAAnB,CAAmClB,QAAnC;AAAA;AAAA;AACH;AACJ;;AA1CoB,O","sourcesContent":["import { EntityManager } from \"../core/EntityManager\";\r\nimport { InputComponent } from \"../components/InputComponent\";\r\nimport { EnemyTag } from \"../components/EnemyTag\";\r\nimport { Position } from \"../components/Position\";\r\n\r\nexport class InputSystem {\r\n    constructor(\r\n        private entityManager: EntityManager,\r\n        private playerId: number\r\n    ) {}\r\n\r\n    /*handleInput(input: InputComponent) {\r\n        this.entityManager.addComponent(input.entity, input, InputComponent);\r\n        console.log(`[InputSystem] Input registered:`, input);\r\n    }*/\r\n\r\n    update(dt: number) {\r\n        const inputs = this.entityManager.getEntityWithComponent(InputComponent);\r\n\r\n        for (const entityId of inputs) {\r\n            const input = this.entityManager.getComponent(entityId, InputComponent);\r\n            const pos = input.target;\r\n\r\n            // Проверка: есть ли враг на позиции\r\n            const enemyIds = this.entityManager.getEntityWithComponent(EnemyTag);\r\n            const enemyAtTarget = enemyIds.find(id => {\r\n                const p = this.entityManager.getComponent(id, Position);\r\n                return p?.x === pos.x && p?.y === pos.y;\r\n            });\r\n\r\n            if (enemyAtTarget) {\r\n                // Добавим движение вплотную\r\n                const playerPos = this.entityManager.getComponent(entityId, Position);\r\n                const moveTarget = this.getAdjacentTo(enemyAtTarget, playerPos);\r\n\r\n                if (moveTarget) {\r\n                    this.entityManager.addComponent(entityId, new MoveIntent(moveTarget), MoveIntent);\r\n                    this.entityManager.addComponent(entityId, new AttackIntent(enemyAtTarget), AttackIntent);\r\n                }\r\n            } else {\r\n                // Просто двигаемся\r\n                this.entityManager.addComponent(entityId, new MoveIntent(pos), MoveIntent);\r\n            }\r\n\r\n            // Удаляем input после обработки\r\n            this.entityManager.removeComponent(entityId, InputComponent);\r\n        }\r\n    }\r\n\r\n}\r\n"]}